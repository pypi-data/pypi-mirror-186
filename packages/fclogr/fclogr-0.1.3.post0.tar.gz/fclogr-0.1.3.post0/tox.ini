# Copyright (c) 2023 Maxwell G <gotmax@e.email>
# SPDX-License-Identifier: GPL-2.0-or-later

[tox]
env_list =
    format
    typing-py{39,310,311}
isolated_build = True

[testenv:typing-py{39,310,311}]
labels =
    lint
    typing
extras =
    lint
commands =
    mypy src/fclogr

[testenv:format]
extras =
    lint
labels =
    lint
ignore_errors = True
commands =
    black {posargs} src/fclogr/
    isort --add-import "from __future__ import annotations" {posargs} src/fclogr/
    reuse lint
    ruff src/fclogr/

[testenv:publish]
skip_install = True
deps =
    dbus-python
    flit
    keyring
    twine
allowlist_externals = *
passenv = *
commands =
    - sh -c 'rm -rf dist/*'
    python -m flit build
    python -m twine check --strict dist/*
    sh -c 'bsdtar tf dist/*.whl | grep LICENSE'
    sh -c 'bsdtar tf dist/*.tar.gz | grep LICENSE'
    python -m twine upload -s -i gotmax@e.email --non-interactive -u __token__ dist/*
    git push --follow-tags
    sh -c 'hut git artifact upload dist/*'
