{"version":3,"file":"chunks/app_views_settings_organizationTeams_teamProjects_tsx.xxxxxxxxxxxxxxxxxxxx.js","mappings":"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","sources":["webpack:///./app/views/settings/components/settingsProjectItem.tsx","webpack:///./app/views/settings/organizationTeams/teamProjects.tsx"],"sourcesContent":["import styled from '@emotion/styled';\n\nimport ProjectBadge from 'sentry/components/idBadge/projectBadge';\nimport BookmarkStar from 'sentry/components/projects/bookmarkStar';\nimport space from 'sentry/styles/space';\nimport {Organization, Project} from 'sentry/types';\n\ntype Props = {\n  organization: Organization;\n  project: Project;\n};\n\nfunction ProjectItem({project, organization}: Props) {\n  return (\n    <Wrapper>\n      <BookmarkStar organization={organization} project={project} />\n      <ProjectBadge\n        to={`/settings/${organization.slug}/projects/${project.slug}/`}\n        avatarSize={18}\n        project={project}\n      />\n    </Wrapper>\n  );\n}\n\nconst Wrapper = styled('div')`\n  display: grid;\n  grid-template-columns: max-content 1fr;\n  align-items: center;\n  gap: ${space(1.5)};\n`;\n\nexport default ProjectItem;\n","import {Component, Fragment} from 'react';\nimport {RouteComponentProps} from 'react-router';\nimport styled from '@emotion/styled';\n\nimport {addErrorMessage, addSuccessMessage} from 'sentry/actionCreators/indicator';\nimport {Client} from 'sentry/api';\nimport {Button} from 'sentry/components/button';\nimport DropdownAutoComplete from 'sentry/components/dropdownAutoComplete';\nimport DropdownButton from 'sentry/components/dropdownButton';\nimport EmptyMessage from 'sentry/components/emptyMessage';\nimport LoadingError from 'sentry/components/loadingError';\nimport LoadingIndicator from 'sentry/components/loadingIndicator';\nimport Pagination from 'sentry/components/pagination';\nimport {Panel, PanelBody, PanelHeader, PanelItem} from 'sentry/components/panels';\nimport Tooltip from 'sentry/components/tooltip';\nimport {IconFlag, IconSubtract} from 'sentry/icons';\nimport {t} from 'sentry/locale';\nimport ProjectsStore from 'sentry/stores/projectsStore';\nimport space from 'sentry/styles/space';\nimport {Organization, Project} from 'sentry/types';\nimport {sortProjects} from 'sentry/utils';\nimport withApi from 'sentry/utils/withApi';\nimport withOrganization from 'sentry/utils/withOrganization';\nimport ProjectListItem from 'sentry/views/settings/components/settingsProjectItem';\n\ntype Props = {\n  api: Client;\n  organization: Organization;\n} & RouteComponentProps<{orgId: string; teamId: string}, {}>;\n\ntype State = {\n  error: boolean;\n  linkedProjects: Project[];\n  loading: boolean;\n  pageLinks: null | string;\n  unlinkedProjects: Project[];\n};\n\ntype DropdownAutoCompleteProps = React.ComponentProps<typeof DropdownAutoComplete>;\ntype Item = Parameters<NonNullable<DropdownAutoCompleteProps['onSelect']>>[0];\n\nclass TeamProjects extends Component<Props, State> {\n  state: State = {\n    error: false,\n    loading: true,\n    pageLinks: null,\n    unlinkedProjects: [],\n    linkedProjects: [],\n  };\n\n  componentDidMount() {\n    this.fetchAll();\n  }\n\n  componentDidUpdate(prevProps: Props) {\n    if (\n      prevProps.params.orgId !== this.props.params.orgId ||\n      prevProps.params.teamId !== this.props.params.teamId\n    ) {\n      this.fetchAll();\n    }\n\n    if (prevProps.location !== this.props.location) {\n      this.fetchTeamProjects();\n    }\n  }\n\n  fetchAll = () => {\n    this.fetchTeamProjects();\n    this.fetchUnlinkedProjects();\n  };\n\n  fetchTeamProjects() {\n    const {\n      location,\n      params: {orgId, teamId},\n    } = this.props;\n\n    this.setState({loading: true});\n\n    this.props.api\n      .requestPromise(`/organizations/${orgId}/projects/`, {\n        query: {\n          query: `team:${teamId}`,\n          cursor: location.query.cursor || '',\n        },\n        includeAllArgs: true,\n      })\n      .then(([linkedProjects, _, resp]) => {\n        this.setState({\n          loading: false,\n          error: false,\n          linkedProjects,\n          pageLinks: resp?.getResponseHeader('Link') ?? null,\n        });\n      })\n      .catch(() => {\n        this.setState({loading: false, error: true});\n      });\n  }\n\n  fetchUnlinkedProjects(query = '') {\n    const {\n      params: {orgId, teamId},\n    } = this.props;\n\n    this.props.api\n      .requestPromise(`/organizations/${orgId}/projects/`, {\n        query: {\n          query: query ? `!team:${teamId} ${query}` : `!team:${teamId}`,\n        },\n      })\n      .then(unlinkedProjects => {\n        this.setState({unlinkedProjects});\n      });\n  }\n\n  handleLinkProject = (project: Project, action: string) => {\n    const {orgId, teamId} = this.props.params;\n    this.props.api.request(`/projects/${orgId}/${project.slug}/teams/${teamId}/`, {\n      method: action === 'add' ? 'POST' : 'DELETE',\n      success: resp => {\n        this.fetchAll();\n        ProjectsStore.onUpdateSuccess(resp);\n        addSuccessMessage(\n          action === 'add'\n            ? t('Successfully added project to team.')\n            : t('Successfully removed project from team')\n        );\n      },\n      error: () => {\n        addErrorMessage(t(\"Wasn't able to change project association.\"));\n      },\n    });\n  };\n\n  handleProjectSelected = (selection: Item) => {\n    const project = this.state.unlinkedProjects.find(p => p.id === selection.value);\n    if (project) {\n      this.handleLinkProject(project, 'add');\n    }\n  };\n\n  handleQueryUpdate = (evt: React.ChangeEvent<HTMLInputElement>) => {\n    this.fetchUnlinkedProjects(evt.target.value);\n  };\n\n  projectPanelContents(projects: Project[]) {\n    const {organization} = this.props;\n    const access = new Set(organization.access);\n    const canWrite = access.has('org:write');\n\n    return projects.length ? (\n      sortProjects(projects).map(project => (\n        <StyledPanelItem key={project.id}>\n          <ProjectListItem project={project} organization={organization} />\n          <Tooltip\n            disabled={canWrite}\n            title={t('You do not have enough permission to change project association.')}\n          >\n            <Button\n              size=\"sm\"\n              disabled={!canWrite}\n              icon={<IconSubtract isCircled size=\"xs\" />}\n              aria-label={t('Remove')}\n              onClick={() => {\n                this.handleLinkProject(project, 'remove');\n              }}\n            >\n              {t('Remove')}\n            </Button>\n          </Tooltip>\n        </StyledPanelItem>\n      ))\n    ) : (\n      <EmptyMessage size=\"large\" icon={<IconFlag size=\"xl\" />}>\n        {t(\"This team doesn't have access to any projects.\")}\n      </EmptyMessage>\n    );\n  }\n\n  render() {\n    const {linkedProjects, unlinkedProjects, error, loading} = this.state;\n\n    if (error) {\n      return <LoadingError onRetry={() => this.fetchAll()} />;\n    }\n\n    if (loading) {\n      return <LoadingIndicator />;\n    }\n\n    const access = new Set(this.props.organization.access);\n\n    const otherProjects = unlinkedProjects.map(p => ({\n      value: p.id,\n      searchKey: p.slug,\n      label: <ProjectListElement>{p.slug}</ProjectListElement>,\n    }));\n\n    return (\n      <Fragment>\n        <Panel>\n          <PanelHeader hasButtons>\n            <div>{t('Projects')}</div>\n            <div style={{textTransform: 'none'}}>\n              {!access.has('org:write') ? (\n                <DropdownButton\n                  disabled\n                  title={t('You do not have enough permission to associate a project.')}\n                  size=\"xs\"\n                >\n                  {t('Add Project')}\n                </DropdownButton>\n              ) : (\n                <DropdownAutoComplete\n                  items={otherProjects}\n                  onChange={this.handleQueryUpdate}\n                  onSelect={this.handleProjectSelected}\n                  emptyMessage={t('No projects')}\n                  alignMenu=\"right\"\n                >\n                  {({isOpen}) => (\n                    <DropdownButton isOpen={isOpen} size=\"xs\">\n                      {t('Add Project')}\n                    </DropdownButton>\n                  )}\n                </DropdownAutoComplete>\n              )}\n            </div>\n          </PanelHeader>\n          <PanelBody>{this.projectPanelContents(linkedProjects)}</PanelBody>\n        </Panel>\n        <Pagination pageLinks={this.state.pageLinks} {...this.props} />\n      </Fragment>\n    );\n  }\n}\n\nconst StyledPanelItem = styled(PanelItem)`\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: ${space(2)};\n`;\n\nconst ProjectListElement = styled('div')`\n  padding: ${space(0.25)} 0;\n`;\n\nexport {TeamProjects};\n\nexport default withApi(withOrganization(TeamProjects));\n"],"names":["ProjectItem","project","organization","Wrapper","to","slug","avatarSize","space","TeamProjects","Component","error","loading","pageLinks","unlinkedProjects","linkedProjects","this","fetchTeamProjects","fetchUnlinkedProjects","action","orgId","teamId","props","params","api","request","method","success","resp","fetchAll","ProjectsStore","addSuccessMessage","t","addErrorMessage","selection","state","find","p","id","value","handleLinkProject","evt","target","componentDidMount","componentDidUpdate","prevProps","location","setState","requestPromise","query","cursor","includeAllArgs","then","_","getResponseHeader","catch","projectPanelContents","projects","canWrite","Set","access","has","length","sortProjects","map","StyledPanelItem","disabled","title","size","icon","isCircled","onClick","render","onRetry","otherProjects","searchKey","label","ProjectListElement","Fragment","hasButtons","style","textTransform","items","onChange","handleQueryUpdate","onSelect","handleProjectSelected","emptyMessage","alignMenu","isOpen","PanelItem","withApi","withOrganization"],"sourceRoot":""}