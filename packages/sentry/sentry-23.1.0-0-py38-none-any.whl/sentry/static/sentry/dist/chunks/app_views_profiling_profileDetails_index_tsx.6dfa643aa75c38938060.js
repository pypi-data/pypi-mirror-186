"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_profiling_profileDetails_index_tsx"],{"./app/utils/profiling/tableRenderer.tsx":(e,t,r)=>{r.d(t,{w:()=>s});var o=r("./app/components/gridEditable/sortLink.tsx"),n=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function s(e){let{currentSort:t,generateSortLink:r,rightAlignedColumns:s,sortableColumns:a,onClick:i}=e;return(e,l)=>(0,n.tZ)(o.Z,{onClick:t=>i?.(e,t),align:s?.has(e.key)?"right":"left",title:e.name,direction:t?.key===e.key?t?.order:void 0,canSort:a?.has(e.key)||!1,generateSortLink:r?.(e.key)??(()=>{}),replace:!0})}},"./app/views/profiling/profileDetails/index.tsx":(e,t,r)=>{r.r(t),r.d(t,{default:()=>X});var o=r("../node_modules/react/index.js"),n=r("./app/components/layouts/thirds.tsx"),s=r("./app/components/sentryDocumentTitle.tsx"),a=r("./app/locale.tsx"),i=r("./app/utils/analytics/trackAdvancedAnalyticsEvent.tsx"),l=r("./app/utils/useOrganization.tsx"),u=r("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),c=(r("../node_modules/core-js/modules/es.array.includes.js"),r("../node_modules/core-js/modules/es.array.push.js"),r("../node_modules/react-router/es/index.js")),p=r("../node_modules/lodash/debounce.js"),d=r.n(p),m=r("./app/components/compactSelect.tsx"),g=r("./app/components/gridEditable/index.tsx"),h=r("./app/components/pagination.tsx"),y=r("./app/components/searchBar.tsx"),f=r("./app/styles/space.tsx"),k=r("./app/utils/discover/styles.tsx"),b=r("./app/utils/profiling/routes.tsx"),w=r("./app/utils/profiling/tableRenderer.tsx"),C=r("./app/utils/profiling/units/units.ts"),v=r("./app/utils/useEffectAfterFirstRender.ts"),S=r("./app/utils/useLocation.tsx"),x=r("./app/utils/useParams.tsx"),Z=r("./app/views/profiling/profileGroupProvider.tsx"),j=r("../node_modules/lodash/groupBy.js"),A=r.n(j);function _(e){const t=[];return e.forEach((e=>{e.selfWeight>0&&t.push(e)}),(()=>{})),t.sort(((e,t)=>t.selfWeight-e.selfWeight)).map((t=>({symbol:t.frame.name,file:t.frame.file,image:t.frame.image,thread:e.threadId,type:t.frame.is_application?"application":"system","self weight":t.selfWeight,"total weight":t.totalWeight})))}function P(e,t){return e.reduce(((e,r)=>{const o=r[t];return o&&!e.includes(o)&&e.push(o),e}),[])}function q(e,t,r){const o=A()(e,(e=>function(e,t){return t.map((t=>e[t])).join(L)}(e,t))),n=[];for(const e in o){const s=T(e,t),a=o[e];r.forEach((e=>{s[e.key]=e.compute(a)})),n.push(s)}return n}const L=String.fromCharCode(31);function T(e,t){const r=e.split(L);return t.reduce(((e,t,o)=>(e[t]=r[o],e)),{})}var z=r("../node_modules/fuse.js/dist/fuse.esm.js"),W=r("../node_modules/query-string/index.js");function F(e){let{key:t,initialState:r}=e;const n=(0,S.T)(),[s,a]=(0,o.useState)(n.query[t]??r),i=(0,o.useCallback)((e=>{const r=c.browserHistory.getCurrentLocation();return{...r,query:{...r.query,[t]:e}}}),[t]),l=(0,o.useCallback)((e=>{c.browserHistory.replace(i(e)),a(e)}),[i]);return(0,o.useEffect)((()=>c.browserHistory.listenBefore((e=>{c.browserHistory.getCurrentLocation().pathname!==e.pathname&&t in e.query&&delete e.query[t]}))),[t]),[s,l,i]}var $=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function E(){const e=(0,S.T)(),t=(0,Z.useProfileGroup)(),[r,n]=F({key:"detailView",initialState:"occurrence"}),[s,i]=F({key:"query",initialState:""}),[l,u]=F({key:"cursor",initialState:""}),c=U[r]??U.occurrence,p=l?parseInt(l,10):0,f=(0,o.useMemo)((()=>{const e="resolved"===t.type?t.data.profiles.flatMap(_):[];return c.transform(e)}),[t,c]),{search:k}=function(e,t){const r=(0,o.useMemo)((()=>new z.default(e,t)),[e]);return{search:(0,o.useCallback)(((t,o)=>t?r.search(t,o).map((e=>e.item)):e),[r,e]),searchIndex:r}}(f,{keys:c.search.key,threshold:.3}),b=(0,o.useMemo)((()=>d()((e=>x(k(e))),500)),[k]),[C,x]=(0,o.useState)(f),[j,A]=F({key:"type"}),[q,L]=F({key:"image"}),{filters:T,columnFilters:E,filterPredicate:M}=function(e,t){const{columns:r}=t,[n,s]=(0,o.useState)((a=t.initialState)?Object.entries(a).reduce(((e,t)=>{let[r,o]=t;return e[r]=void 0,Array.isArray(o)&&(e[r]=o),"string"==typeof o&&(e[r]=[o]),e}),{}):{});var a;const i=(0,o.useMemo)((()=>{function t(e){return t=>{s((r=>({...r,[e]:t.length>0?t.map((e=>e.value)):void 0})))}}return r.reduce(((r,o)=>(r[o]={values:P(e,o).sort(((e,t)=>e.localeCompare(t))),onChange:t(o)},r)),{})}),[e,r]),l=(0,o.useRef)(!1);(0,o.useEffect)((()=>{l.current||0===e.length||(s((e=>Object.entries(e).reduce(((e,t)=>{const[r,o]=t,n=i[r].values,s=o?.filter((e=>n.includes(e)));return e[r]=Array.isArray(s)&&s.length>0?s:void 0,e}),{}))),l.current=!0)}),[e.length,i,n]);const u=(0,o.useCallback)((e=>{let t=!0;for(const r in n){const o=n[r];if(!o)continue;const s=e[r];if(t=o.includes(s),!t)return!1}return t}),[n]);return{filters:n,columnFilters:i,filterPredicate:u}}(f,{columns:["type","image"],initialState:{type:j,image:q}});(0,o.useEffect)((()=>{A(T.type),L(T.image)}),[T,A,L]);const{currentSort:B,generateSortLink:R,sortCompareFn:G}=function(e){const{sortableColumns:t,querystringKey:r,defaultSort:n}=e,[s,a,i]=F({key:r}),l=(0,o.useMemo)((()=>{let e=s??"";const r="-"===e[0];return r&&(e=e.slice(1)),e&&t.includes(e)?{key:e,order:r?"desc":"asc"}:n}),[t,n,s]),u=(0,o.useCallback)((e=>{if(!t.includes(e))return()=>{};if(!l)return()=>i(e);const r=l.key===e&&"desc"===l.order?"asc":"desc";return()=>i(`${"desc"===r?"-":""}${e}`)}),[l,t,i]),c=(0,o.useCallback)(((e,t)=>{const r=e[l.key],o=t[l.key];return r&&o?"number"==typeof r&&"number"==typeof o?"asc"===l.order?r-o:o-r:"string"==typeof r&&"string"==typeof o?"asc"===l.order?r.localeCompare(o):o.localeCompare(r):1:1}),[l]);return{currentSort:l,generateSortLink:u,sortCompareFn:c}}({...c.sort,querystringKey:"functionsSort"}),O=(0,o.useCallback)((e=>{i(e),u(void 0),b(e)}),[u,i,b]);(0,v.K)((()=>{x(k(s??""))}),[f,k]);const N=(0,o.useMemo)((()=>C.filter(M)),[M,C]),K=(0,o.useMemo)((()=>N.sort(G)),[N,G]),V=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50;const n=(0,S.T)();return(0,o.useMemo)((()=>{const o=t>=r?"true":"false",s=t>=r?t-r:0,a={...n.query,cursor:s},i=`<${n.pathname}${W.stringify(a)}>; rel="previous"; results="${o}"; cursor="${s}"`,l=t+r<e.length?"true":"false",u=t+r<e.length?t+r:0,c={...n.query,cursor:u};return`${i},<${n.pathname}${W.stringify(c)}>; rel="next"; results="${l}"; cursor="${u}"`}),[t,n,e,r])}(K,p),X=K.slice(p,p+50);return(0,$.BX)(o.Fragment,{children:[(0,$.BX)(H,{children:[(0,$.tZ)(m.Z,{options:Object.values(U).map((e=>e.option)),value:c.option.value,triggerProps:{prefix:(0,a.t)("View")},placement:"bottom right",onChange:e=>{i(""),u(void 0),n(e.value)}}),(0,$.tZ)(y.Z,{defaultQuery:"",query:s,placeholder:c.search.placeholder,onChange:O}),(0,$.tZ)(m.Z,{options:E.type.values.map((e=>({value:e,label:e}))),value:T.type,triggerLabel:!T.type||Array.isArray(T.type)&&T.type.length===E.type.values.length?(0,a.t)("All"):void 0,triggerProps:{prefix:(0,a.t)("Type")},multiple:!0,onChange:E.type.onChange,placement:"bottom right"}),(0,$.tZ)(m.Z,{options:E.image.values.map((e=>({value:e,label:e}))),value:T.image,triggerLabel:!T.image||Array.isArray(T.image)&&T.image.length===E.image.values.length?(0,a.t)("All"):void 0,triggerProps:{prefix:(0,a.t)("Package")},multiple:!0,onChange:E.image.onChange,placement:"bottom right",isSearchable:!0})]}),(0,$.tZ)(g.ZP,{isLoading:"loading"===t.type,error:"errored"===t.type,data:X,columnOrder:c.columns.map((e=>D[e])),columnSortBy:[B],scrollable:!0,stickyHeader:!0,height:"75vh",grid:{renderHeadCell:(0,w.w)({rightAlignedColumns:new Set(c.rightAlignedColumns),sortableColumns:new Set(c.rightAlignedColumns),currentSort:B,generateSortLink:R}),renderBodyCell:I},location:e}),(0,$.tZ)(h.Z,{pageLinks:V,onCursor:e=>{u(e)}})]})}E.displayName="ProfileDetailsTable";const H=(0,u.Z)("div",{target:"e1qhas5a0"})("display:grid;grid-template-columns:auto 1fr auto auto;gap:",(0,f.Z)(2),";margin-bottom:",(0,f.Z)(2),";");function I(e,t,r,o){return(0,$.tZ)(B,{column:e,dataRow:t,rowIndex:r,columnIndex:o})}I.displayName="renderFunctionCell";const M=(0,C.s4)("nanoseconds");function B(e){let{column:t,dataRow:r}=e;const o=r[t.key],{orgId:n,projectId:s,eventId:i}=(0,x.U)();switch(t.key){case"p75":case"p95":case"self weight":case"total weight":return(0,$.tZ)(k.Hw,{children:M(o)});case"count":return(0,$.tZ)(k.Hw,{children:o});case"image":return(0,$.tZ)(k.W2,{children:o??(0,a.t)("Unknown")});case"thread":return(0,$.tZ)(k.W2,{children:(0,$.tZ)(c.Link,{to:(0,b.TH)({orgSlug:n,projectSlug:s,profileId:i,query:{tid:r.thread}}),children:o})});case"symbol":return(0,$.tZ)(k.W2,{children:(0,$.tZ)(c.Link,{to:(0,b.TH)({orgSlug:n,projectSlug:s,profileId:i,query:{frameName:r.symbol,framePackage:r.image,tid:r.thread??r.tids?.[0]}}),children:o})});default:return(0,$.tZ)(k.W2,{children:o})}}const D={symbol:{key:"symbol",name:(0,a.t)("Symbol"),width:g.z7},image:{key:"image",name:(0,a.t)("Package"),width:g.z7},file:{key:"file",name:(0,a.t)("File"),width:g.z7},thread:{key:"thread",name:(0,a.t)("Thread"),width:g.z7},type:{key:"type",name:(0,a.t)("Type"),width:g.z7},"self weight":{key:"self weight",name:(0,a.t)("Self Weight"),width:g.z7},"total weight":{key:"total weight",name:(0,a.t)("Total Weight"),width:g.z7},p75:{key:"p75",name:(0,a.t)("P75(Self)"),width:g.z7},p95:{key:"p95",name:(0,a.t)("P95(Self)"),width:g.z7},count:{key:"count",name:(0,a.t)("Count"),width:g.z7}},R=(e,t)=>{const r=Array.from(e).sort(((e,t)=>e-t)),o=t*(r.length-1),n=Math.floor(o),s=o%1;return o===n?r[o]:r[n]*(1-s)+r[n+1]*s},G={key:"p75",compute:e=>R(e.map((e=>e["self weight"])),.75)},O={key:"p95",compute:e=>R(e.map((e=>e["self weight"])),.95)},N={key:"count",compute:e=>e.length},K={key:"tids",compute:e=>e.reduce(((e,t)=>{const r=t.thread;return e.includes(r)||e.push(r),e}),[])},U={occurrence:{option:{label:(0,a.t)("Slowest Functions"),value:"occurrence"},columns:["symbol","image","file","thread","type","self weight","total weight"],transform:e=>e.slice(0,500),search:{key:["symbol"],placeholder:(0,a.t)("Search for frames")},sort:{sortableColumns:["self weight","total weight"],defaultSort:{key:"self weight",order:"desc"}},rightAlignedColumns:["self weight","total weight"]},symbol:{option:{label:(0,a.t)("Group by Symbol"),value:"symbol"},columns:["symbol","type","image","p75","p95","count"],search:{key:["symbol"],placeholder:(0,a.t)("Search for frames")},transform:e=>q(e,["symbol","type","image"],[G,O,N,K]),sort:{sortableColumns:["p75","p95","count"],defaultSort:{key:"p75",order:"desc"}},rightAlignedColumns:["p75","p95","count"]},package:{option:{label:(0,a.t)("Group by Package"),value:"package"},columns:["image","type","p75","p95","count"],search:{key:["image"],placeholder:(0,a.t)("Search for packages")},transform:e=>q(e,["type","image"],[G,O,N]),sort:{sortableColumns:["p75","p95","count"],defaultSort:{key:"p75",order:"desc"}},rightAlignedColumns:["p75","p95","count"]},file:{option:{label:(0,a.t)("Group by File"),value:"file"},columns:["file","type","image","p75","p95","count"],search:{key:["file"],placeholder:(0,a.t)("Search for files")},transform:e=>q(e,["type","image","file"],[G,O,N]),sort:{sortableColumns:["p75","p95","count"],defaultSort:{key:"p75",order:"desc"}},rightAlignedColumns:["p75","p95","count"]}};function V(){const e=(0,l.Z)();return(0,o.useEffect)((()=>{(0,i.Z)("profiling_views.profile_summary",{organization:e})}),[e]),(0,$.tZ)(o.Fragment,{children:(0,$.tZ)(s.Z,{title:(0,a.t)("Profiling — Details"),orgSlug:e.slug,children:(0,$.tZ)(n.uT,{children:(0,$.tZ)(n.or,{fullWidth:!0,children:(0,$.tZ)(E,{})})})})})}V.displayName="ProfileDetails";const X=V}}]);
//# sourceMappingURL=../sourcemaps/app_views_profiling_profileDetails_index_tsx.5b0bcbeb577905fe8edd278f7962f561.js.map