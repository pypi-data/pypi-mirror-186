"use strict";(self.webpackChunk_JUPYTERLAB_CORE_OUTPUT=self.webpackChunk_JUPYTERLAB_CORE_OUTPUT||[]).push([[9086],{89086:(e,t,s)=>{s.r(t),s.d(t,{CONTEXT_PROVIDER_ID:()=>I,Completer:()=>x,CompleterModel:()=>u,CompletionHandler:()=>a,CompletionProviderManager:()=>k,ContextCompleterProvider:()=>S,ICompletionProviderManager:()=>b,KERNEL_PROVIDER_ID:()=>E,KernelCompleterProvider:()=>T,ProviderReconciliator:()=>P});var i=s(90877),o=s(68732),n=s(7191);const r="jp-mod-completer-enabled",l="jp-mod-completer-active";class a{constructor(e){this._editor=null,this._enabled=!1,this._isDisposed=!1,this._autoCompletion=!1,this.completer=e.completer,this.completer.selected.connect(this.onCompletionSelected,this),this.completer.visibilityChanged.connect(this.onVisibilityChanged,this),this._reconciliator=e.reconciliator}set reconciliator(e){this._reconciliator=e}get editor(){return this._editor}set editor(e){if(e===this._editor)return;let t=this._editor;if(t&&!t.isDisposed){const e=t.model;t.host.classList.remove(r),t.host.classList.remove(l),e.selections.changed.disconnect(this.onSelectionsChanged,this),e.sharedModel.changed.disconnect(this.onTextChanged,this)}if(this.completer.reset(),this.completer.editor=e,t=this._editor=e,t){const e=t.model;this._enabled=!1,e.selections.changed.connect(this.onSelectionsChanged,this),e.sharedModel.changed.connect(this.onTextChanged,this),this.onSelectionsChanged()}}get isDisposed(){return this._isDisposed}set autoCompletion(e){this._autoCompletion=e}get autoCompletion(){return this._autoCompletion}dispose(){this.isDisposed||(this._isDisposed=!0,n.Signal.clearData(this))}invoke(){o.MessageLoop.sendMessage(this,a.Msg.InvokeRequest)}processMessage(e){e.type===a.Msg.InvokeRequest.type&&this.onInvokeRequest(e)}getState(e,t){return{text:e.model.sharedModel.getSource(),lineHeight:e.lineHeight,charWidth:e.charWidth,line:t.line,column:t.column}}onCompletionSelected(e,t){const s=e.model,i=this._editor;if(!i||!s)return;const o=s.createPatch(t);if(!o)return;const{start:n,end:r,value:l}=o,a=i.getOffsetAt(i.getCursorPosition());i.model.sharedModel.updateSource(n,r,l),a<=r&&a>=n&&i.setCursorPosition(i.getPositionAt(n+l.length))}onInvokeRequest(e){if(!this.completer.model)return;if(this.completer.model.original)return;const t=this._editor;t&&this._makeRequest(t.getCursorPosition()).catch((e=>{console.warn("Invoke request bailed",e)}))}onSelectionsChanged(){const e=this.completer.model,t=this._editor;if(!t)return;const s=t.host;if(!e)return this._enabled=!1,void s.classList.remove(r);if(e.subsetMatch)return;const i=t.getCursorPosition(),o=t.getLine(i.line);if(!o)return this._enabled=!1,e.reset(!0),void s.classList.remove(r);const{start:n,end:l}=t.getSelection();return n.column!==l.column||n.line!==l.line||o.slice(0,i.column).match(/^\s*$/)?(this._enabled=!1,e.reset(!0),void s.classList.remove(r)):(this._enabled||(this._enabled=!0,s.classList.add(r)),void e.handleCursorChange(this.getState(t,t.getCursorPosition())))}onTextChanged(e,t){const s=this.completer.model;if(!s||!this._enabled)return;const i=this.editor;if(!i)return;this._autoCompletion&&this._reconciliator.shouldShowContinuousHint&&this._reconciliator.shouldShowContinuousHint(this.completer.isVisible,t)&&this._makeRequest(i.getCursorPosition());const{start:o,end:n}=i.getSelection();o.column===n.column&&o.line===n.line&&s.handleTextChange(this.getState(i,i.getCursorPosition()))}onVisibilityChanged(e){e.isDisposed||e.isHidden?this._editor&&(this._editor.host.classList.remove(l),this._editor.focus()):this._editor&&this._editor.host.classList.add(l)}_makeRequest(e){const t=this.editor;if(!t)return Promise.reject(new Error("No active editor"));const s=t.model.sharedModel.getSource(),o=i.Text.jsIndexToCharIndex(t.getOffsetAt(e),s),n=this.getState(t,e),r={text:s,offset:o};return this._reconciliator.fetch(r).then((e=>{if(!e)return;const t=this._updateModel(n,e.start,e.end);t&&t.setCompletionItems&&t.setCompletionItems(e.items)})).catch((e=>{}))}_updateModel(e,t,s){const o=this.completer.model,n=e.text;return o?(o.original=e,o.cursor={start:i.Text.charIndexToJsIndex(t,n),end:i.Text.charIndexToJsIndex(s,n)},o):null}}!function(e){let t;!function(e){e.InvokeRequest=new o.Message("invoke-request")}(t=e.Msg||(e.Msg={}))}(a||(a={}));var d,c=s(94074),h=s(76103);class u{constructor(){this._current=null,this._cursor=null,this._isDisposed=!1,this._completionItems=[],this._original=null,this._query="",this._subsetMatch=!1,this._typeMap={},this._orderedTypes=[],this._stateChanged=new n.Signal(this),this._resolvingItem=0}get stateChanged(){return this._stateChanged}get original(){return this._original}set original(e){this._original===e||this._original&&e&&h.JSONExt.deepEqual(e,this._original)||(this._reset(),this._current=this._original=e,this._stateChanged.emit(void 0))}get current(){return this._current}set current(e){if(this._current===e||this._current&&e&&h.JSONExt.deepEqual(e,this._current))return;const t=this._original;if(!t)return;const s=this._cursor;if(!s)return;const i=this._current=e;if(!i)return void this._stateChanged.emit(void 0);const o=t.text.split("\n")[t.line],n=i.text.split("\n")[i.line];if(!this._subsetMatch&&n.length<o.length)return void this.reset(!0);const{start:r,end:l}=s;let a=i.text.substring(r);const d=t.text.substring(l);a=a.substring(0,a.lastIndexOf(d)),this._query=a,this._stateChanged.emit(void 0)}get cursor(){return this._cursor}set cursor(e){this.original&&(this._cursor=e)}get query(){return this._query}set query(e){this._query=e}get subsetMatch(){return this._subsetMatch}set subsetMatch(e){this._subsetMatch=e}get isDisposed(){return this._isDisposed}dispose(){this._isDisposed||(this._isDisposed=!0,n.Signal.clearData(this))}completionItems(){let e=this._query;return e?this._markup(e):this._completionItems}setCompletionItems(e){h.JSONExt.deepEqual(e,this._completionItems)||(this._completionItems=e,this._orderedTypes=d.findOrderedCompletionItemTypes(this._completionItems),this._stateChanged.emit(void 0))}typeMap(){return this._typeMap}orderedTypes(){return this._orderedTypes}handleCursorChange(e){if(!this._original)return;const{column:t,line:s}=e,{current:i,original:o}=this;if(!o)return;if(s!==o.line)return void this.reset(!0);if(t<o.column)return void this.reset(!0);const{cursor:n}=this;if(!n||!i)return;const r=n.end-n.start,l=o.text.split("\n")[o.line],a=i.text.split("\n")[i.line].length-l.length;t>o.column+r+a&&this.reset(!0)}handleTextChange(e){const t=this._original;if(!t)return;const{text:s,column:i,line:o}=e,n=s.split("\n")[o][i-1];n&&n.match(/\S/)||e.column>=t.column?this.current=e:this.reset(!1)}createPatch(e){const t=this._original,s=this._cursor,i=this._current;if(!t||!s||!i)return;let{start:o,end:n}=s;return n+=i.text.length-t.text.length,{start:o,end:n,value:e}}reset(e=!1){!e&&this._subsetMatch||(this._reset(),this._stateChanged.emit(void 0))}_markup(e){const t=this._completionItems;let s=[];for(let i of t){const t=i.label.indexOf("("),o=t>-1?i.label.substring(0,t):i.label;let n=c.StringExt.matchSumOfSquares(o,e);if(n){let e=c.StringExt.highlight(i.label,n.indices,d.mark);s.push({...i,documentation:i.documentation,label:e.join(""),insertText:i.insertText?i.insertText:i.label,score:n.score})}}return s.sort(d.scoreCmp2),s.forEach((e=>{delete e.score})),s}resolveItem(e){const t=++this._resolvingItem;let s;if(!this.completionItems)return;let i=this.completionItems();if(!i||!i[e])return;let o=i[e];if(o.resolve){let e;o.insertText&&(e=this.createPatch(o.insertText)),s=o.resolve(e)}else s=Promise.resolve(o);return s.then((e=>(Object.keys(e).forEach((t=>{o[t]=e[t]})),o.resolve=void 0,t!==this._resolvingItem?Promise.resolve(null):e))).catch((e=>(console.error(e),Promise.resolve(o))))}_reset(){this._current=null,this._cursor=null,this._completionItems=[],this._original=null,this._query="",this._subsetMatch=!1,this._typeMap={},this._orderedTypes=[]}}!function(e){const t=["function","instance","class","module","keyword"],s=t.reduce(((e,t)=>(e[t]=null,e)),{});e.mark=function(e){return`<mark>${e}</mark>`},e.scoreCmp=function(e,t){const s=e.score-t.score;return 0!==s?s:e.raw.localeCompare(t.raw)},e.scoreCmp2=function(e,t){var s,i,o;const n=e.score-t.score;return 0!==n?n:null!==(o=null===(s=e.insertText)||void 0===s?void 0:s.localeCompare(null!==(i=t.insertText)&&void 0!==i?i:""))&&void 0!==o?o:0},e.findOrderedCompletionItemTypes=function(e){const s=new Set;e.forEach((e=>{!e.type||t.includes(e.type)||s.has(e.type)||s.add(e.type)}));const i=Array.from(s);return i.sort(((e,t)=>e.localeCompare(t))),t.concat(i)},e.findOrderedTypes=function(e){const i=Object.keys(e).map((t=>e[t])).filter((e=>!!e&&!(e in s))).sort(((e,t)=>e.localeCompare(t)));return t.concat(i)}}(d||(d={}));var m=s(50645),p=s(20139),_=s(52086),g=s(90189),v=s(22202);const f="jp-Completer-item",C="jp-mod-active",y=!0;class x extends v.Widget{constructor(e){var t,s,i,o;super({node:document.createElement("div")}),this._activeIndex=0,this._editor=null,this._model=null,this._resetFlag=!1,this._selected=new n.Signal(this),this._visibilityChanged=new n.Signal(this),this._indexChanged=new n.Signal(this),this._lastSubsetMatch="",this.sanitizer=null!==(t=e.sanitizer)&&void 0!==t?t:new m.Sanitizer,this._renderer=null!==(s=e.renderer)&&void 0!==s?s:x.getDefaultRenderer(this.sanitizer),this.model=null!==(i=e.model)&&void 0!==i?i:null,this.editor=null!==(o=e.editor)&&void 0!==o?o:null,this.addClass("jp-Completer")}get activeIndex(){return this._activeIndex}get editor(){return this._editor}set editor(e){this._editor=e}get selected(){return this._selected}get visibilityChanged(){return this._visibilityChanged}get indexChanged(){return this._indexChanged}get model(){return this._model}set model(e){(e||this._model)&&e!==this._model&&(this._model&&this._model.stateChanged.disconnect(this.onModelStateChanged,this),this._model=e,this._model&&this._model.stateChanged.connect(this.onModelStateChanged,this))}set showDocsPanel(e){this._showDoc=e}get showDocsPanel(){return this._showDoc}dispose(){this._model=null,super.dispose()}handleEvent(e){if(!this.isHidden&&this._editor)switch(e.type){case"keydown":this._evtKeydown(e);break;case"mousedown":this._evtMousedown(e);break;case"scroll":this._evtScroll(e)}}reset(){this._activeIndex=0,this._lastSubsetMatch="",this._model&&this._model.reset(!0)}selectActive(){const e=this.node.querySelector(".jp-mod-active");e?(this._selected.emit(e.getAttribute("data-value")),this.reset()):this.reset()}onAfterAttach(e){document.addEventListener("keydown",this,y),document.addEventListener("mousedown",this,y),document.addEventListener("scroll",this,y)}onBeforeDetach(e){document.removeEventListener("keydown",this,y),document.removeEventListener("mousedown",this,y),document.removeEventListener("scroll",this,y)}onModelStateChanged(){this.isAttached&&(this._activeIndex=0,this._indexChanged.emit(this._activeIndex),this.update())}onUpdateRequest(e){var t;const s=this._model;if(!s)return;if(this._resetFlag)return this._resetFlag=!1,void(this.isHidden||(this.hide(),this._visibilityChanged.emit(void 0)));let i=null,o=s.completionItems();if(i=this._createCompletionItemNode(s,o),!i)return;if(i.querySelectorAll(`.${f}`)[this._activeIndex].classList.add(C),this._showDoc){let e=document.createElement("div");e.className="jp-Completer-docpanel",i.appendChild(e)}const n=null===(t=this.model)||void 0===t?void 0:t.resolveItem(this._activeIndex);this._updateDocPanel(n),s.query||!this._populateSubset()?this.isHidden?(this.show(),this._setGeometry(),this._visibilityChanged.emit(void 0)):this._setGeometry():this.update()}_createCompletionItemNode(e,t){if(!t.length)return this._resetFlag=!0,this.reset(),this.isHidden||(this.hide(),this._visibilityChanged.emit(void 0)),null;let s=this.node;s.textContent="";let i=e.orderedTypes(),o=document.createElement("ul");o.className="jp-Completer-list";for(let e of t){let t=this._renderer.createCompletionItemNode(e,i);o.appendChild(t)}return s.appendChild(o),s}_cycle(e){var t;const s=this.node.querySelectorAll(`.${f}`),i=this._activeIndex;let o=this.node.querySelector(".jp-mod-active");if(o.classList.remove(C),"up"===e)this._activeIndex=0===i?s.length-1:i-1;else if("down"===e)this._activeIndex=i<s.length-1?i+1:0;else{const t=this.node.getBoundingClientRect().height,n=o.getBoundingClientRect().height,r=Math.floor(t/n);this._activeIndex="pageUp"===e?i-r:i+r,this._activeIndex=Math.min(Math.max(0,this._activeIndex),s.length-1)}o=s[this._activeIndex],o.classList.add(C);let n=this.node.querySelector(".jp-Completer-list");g.ElementExt.scrollIntoViewIfNeeded(n,o),this._indexChanged.emit(this._activeIndex);const r=null===(t=this.model)||void 0===t?void 0:t.resolveItem(this._activeIndex);this._updateDocPanel(r)}_evtKeydown(e){if(!this.isHidden&&this._editor)if(this._editor.host.contains(e.target))switch(e.keyCode){case 9:{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();const t=this._model;if(!t)return;const s=t.completionItems();if(s&&1===s.length)return this._selected.emit(s[0].insertText||s[0].label),void this.reset();const i=this._populateSubset();return t.query&&t.query!=this._lastSubsetMatch&&(t.subsetMatch=!0,this._selected.emit(t.query),t.subsetMatch=!1,this._lastSubsetMatch=t.query),i&&this.update(),void this._cycle(e.shiftKey?"up":"down")}case 27:return e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),void this.reset();case 33:case 34:case 38:case 40:{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();const t=w.keyCodeMap[e.keyCode];return void this._cycle(t)}default:return}else this.reset()}_evtMousedown(e){if(this.isHidden||!this._editor)return;if(w.nonstandardClick(e))return void this.reset();let t=e.target;for(;t!==document.documentElement;){if(t.classList.contains(f))return e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),this._selected.emit(t.getAttribute("data-value")),void this.reset();if(t===this.node)return e.preventDefault(),e.stopPropagation(),void e.stopImmediatePropagation();t=t.parentElement}this.reset()}_evtScroll(e){if(this.isHidden||!this._editor)return;const{node:t}=this;t.contains(e.target)||requestAnimationFrame((()=>{this._setGeometry()}))}_populateSubset(){const{model:e}=this;if(!e)return!1;const t=this.node.querySelectorAll(`.${f}`),s=w.commonSubset(w.itemValues(t)),{query:i}=e;return!(!s||s===i||0!==s.indexOf(i)||(e.query=s,0))}_setGeometry(){const{node:e}=this,t=this._model,s=this._editor;if(!(s&&t&&t.original&&t.cursor))return;const i=t.cursor.start,o=s.getPositionAt(i),n=s.getCoordinateForPosition(o),r=window.getComputedStyle(e),l=parseInt(r.borderLeftWidth,10)||0,a=parseInt(r.paddingLeft,10)||0,d=s.host.closest(".jp-MainAreaWidget > .lm-Widget")||s.host;_.HoverBox.setGeometry({anchor:n,host:d,maxHeight:300,minHeight:20,node:e,offset:{horizontal:l+a},privilege:"below",style:r,outOfViewDisplay:{top:"hidden-inside",bottom:"hidden-inside",left:"stick-inside",right:"stick-outside"}})}_createLoadingBar(){const e=document.createElement("div");e.classList.add("jp-Completer-loading-bar-container");const t=document.createElement("div");return t.classList.add("jp-Completer-loading-bar"),e.append(t),e}_updateDocPanel(e){let t=this.node.querySelector(".jp-Completer-docpanel");t&&(e?(t.textContent="",t.appendChild(this._createLoadingBar()),e.then((e=>{var s;if(e)if(e.documentation){let i;i=(null!==(s=this._renderer.createDocumentationNode)&&void 0!==s?s:x.getDefaultRenderer(this.sanitizer).createDocumentationNode)(e),t.textContent="",t.appendChild(i),t.setAttribute("style","")}else t.setAttribute("style","display:none")})).catch((e=>console.error(e)))):t.setAttribute("style","display:none"))}}var w;!function(e){class t{constructor(e=new m.Sanitizer){this.sanitizer=e}createCompletionItemNode(e,t){let s=this._createBaseNode(e.insertText||e.label);return e.deprecated&&s.classList.add("jp-Completer-deprecated"),this._constructNode(s,this._createMatchNode(e.label),!!e.type,e.type,t,e.icon)}createDocumentationNode(e){const t=document.createElement("div");t.classList.add("jp-RenderedText");const s=e.documentation||"";return(0,p.renderText)({host:t,sanitizer:{sanitize:e=>e},source:s}).catch(console.error),t}_createBaseNode(e){const t=document.createElement("li");return t.className=f,t.setAttribute("data-value",e),t}_createMatchNode(e){const t=document.createElement("code");return t.className="jp-Completer-match",t.innerHTML=this.sanitizer.sanitize(e,{allowedTags:["mark"]}),t}_constructNode(e,t,s,i,o,n){if(n){const t=n.element({className:"jp-Completer-type jp-Completer-icon"});e.appendChild(t)}else if(s){const t=document.createElement("span");t.textContent=(i[0]||"").toLowerCase();const s=o.indexOf(i)%10+1;t.className="jp-Completer-type jp-Completer-monogram",t.setAttribute("data-color-index",s.toString()),e.appendChild(t)}else{const t=document.createElement("span");t.className="jp-Completer-monogram",e.appendChild(t)}if(e.appendChild(t),s){e.title=i;const t=document.createElement("code");t.className="jp-Completer-typeExtended",t.textContent=i.toLocaleLowerCase(),e.appendChild(t)}else{const t=document.createElement("span");t.className="jp-Completer-typeExtended",e.appendChild(t)}return e}}let s;e.Renderer=t,e.getDefaultRenderer=function(e){return(!s||e&&s.sanitizer!==e)&&(s=new t(e)),s}}(x||(x={})),function(e){e.keyCodeMap={38:"up",40:"down",33:"pageUp",34:"pageDown"},e.commonSubset=function(e){const t=e.length;let s="";if(t<2)return s;const i=e[0].length;for(let o=0;o<i;o++){const i=e[0][o];for(let n=1;n<t;n++)if(e[n][o]!==i)return s;s+=i}return s},e.itemValues=function(e){const t=[];for(let s=0,i=e.length;s<i;s++){const i=e[s].getAttribute("data-value");i&&t.push(i)}return t},e.nonstandardClick=function(e){return 0!==e.button||e.altKey||e.ctrlKey||e.shiftKey||e.metaKey}}(w||(w={}));const b=new h.Token("@jupyterlab/completer:ICompletionProviderManager");class P{constructor(e){this._resolveFactory=(e,t)=>e.resolve?s=>e.resolve(t,this._context,s):void 0,this._fetching=0,this._providers=e.providers,this._context=e.context,this._timeout=e.timeout}async fetch(e){const t=++this._fetching;let s=[];for(const i of this._providers){let o;o=i.fetch(e,this._context).then((e=>{if(t!==this._fetching)return Promise.reject(void 0);const s=e.items.map((e=>({...e,resolve:this._resolveFactory(i,e)})));return{...e,items:s}}));const n=new Promise((e=>setTimeout((()=>e(null)),this._timeout)));o=Promise.race([o,n]),s.push(o.catch((e=>e)))}const i=Promise.all(s);return this._mergeCompletions(i)}shouldShowContinuousHint(e,t){return this._providers[0].shouldShowContinuousHint?this._providers[0].shouldShowContinuousHint(e,t):this._defaultShouldShowContinuousHint(e,t)}_alignPrefixes(e,t,s){if(t!=s){const t=this._context.editor;if(!t)return e;const i=t.getCursorPosition(),o=t.getLine(i.line);return o?e.map((e=>{if(e.start==s)return e;let t=o.substring(e.start,s);return{...e,items:e.items.map((e=>{let s=e.insertText||e.label;return e.insertText=s.startsWith(t)?s.slice(t.length):s,e}))}})):e}return e}async _mergeCompletions(e){let t=(await e).filter((e=>!(!e||e instanceof Error||!e.items.length)));if(0==t.length)return null;if(1==t.length)return t[0];const s=Math.min(...t.map((e=>e.end))),i=t.map((e=>e.start)),o=Math.min(...i),n=Math.max(...i);t=this._alignPrefixes(t,o,n);const r=new Set,l=new Array;for(const e of t)e.items.forEach((e=>{let t=(e.insertText||e.label).trim();r.has(t)||(r.add(t),l.push(e))}));return{start:n,end:s,items:l}}_defaultShouldShowContinuousHint(e,t){return!e&&(null==t.sourceChange||t.sourceChange.some((e=>null!=e.insert&&e.insert.length>0)))}}const I="CompletionProvider:context";class S{constructor(){this.identifier=I,this.renderer=null}async isApplicable(e){return!0}fetch(e,t){const s=t.editor;return s?new Promise((e=>{e(M.contextHint(s))})):Promise.reject("No editor")}}var M;!function(e){e.contextHint=function(e){const t=e.getTokenAtCursor(),s=function(e,t){return t.getTokens().filter((t=>0===t.value.indexOf(e.value)&&t.value!==e.value))}(t,e),i=s.filter((e=>e.type)).map((e=>e.value)),o=new Set(i),n=new Array;return o.forEach((e=>n.push({label:e}))),{start:t.offset,end:t.offset+t.value.length,items:n}}}(M||(M={}));const E="CompletionProvider:kernel";class T{constructor(){this.identifier=E,this.renderer=null}async isApplicable(e){var t;return!!(null===(t=e.session)||void 0===t?void 0:t.kernel)}async fetch(e,t){var s;const i=null===(s=t.session)||void 0===s?void 0:s.kernel;if(!i)throw new Error("No kernel for completion request.");const o={code:e.text,cursor_pos:e.offset},n=(await i.requestComplete(o)).content;if("ok"!==n.status)throw new Error("Completion fetch failed to return successfully.");const r=new Array,l=n.metadata._jupyter_types_experimental;return n.matches.forEach(((e,t)=>{l[t]?r.push({label:e,type:l[t].type,insertText:l[t].text}):r.push({label:e})})),{start:n.cursor_start,end:n.cursor_end,items:r}}async resolve(e,t,s){const{editor:o,session:n}=t;if(n&&o){let t=o.model.sharedModel.getSource();const r=o.getCursorPosition();let l=i.Text.jsIndexToCharIndex(o.getOffsetAt(r),t);const a=n.kernel;if(!t||!a)return Promise.resolve(e);if(s){const{start:e,value:i}=s;t=t.substring(0,e)+i,l+=i.length}const d={code:t,cursor_pos:l,detail_level:0},c=(await a.requestInspect(d)).content;return"ok"===c.status&&c.found?(e.documentation=c.data["text/plain"],e):e}return e}shouldShowContinuousHint(e,t){const s=t.sourceChange;return null==s||!s.some((e=>null!=e.delete))&&s.some((t=>null!=t.insert&&("."===t.insert||!e&&t.insert.trim().length>0)))}}class k{constructor(){this._activeProviders=new Set([E,I]),this._providers=new Map,this._panelHandlers=new Map,this._activeProvidersChanged=new n.Signal(this)}get activeProvidersChanged(){return this._activeProvidersChanged}setTimeout(e){this._timeout=e}setShowDocumentationPanel(e){this._panelHandlers.forEach((t=>t.completer.showDocsPanel=e)),this._showDoc=e}setContinuousHinting(e){this._panelHandlers.forEach((t=>t.autoCompletion=e)),this._autoCompletion=e}registerProvider(e){const t=e.identifier;this._providers.has(t)?console.warn(`Completion service with identifier ${t} is already registered`):this._providers.set(t,e)}getProviders(){return this._providers}activateProvider(e){this._activeProviders=new Set([]),e.forEach((e=>{this._providers.has(e)&&this._activeProviders.add(e)})),0===this._activeProviders.size&&(this._activeProviders.add(E),this._activeProviders.add(I)),this._activeProvidersChanged.emit()}async updateCompleter(e){const{widget:t,editor:s}=e,i=t.id,o=this._panelHandlers.get(i);if(o)o.completer.showDocsPanel=this._showDoc,o.autoCompletion=this._autoCompletion,s&&(o.editor=s,o.reconciliator=await this.generateReconciliator(e));else{const s=await this.generateHandler(e);this._panelHandlers.set(t.id,s),t.disposed.connect((e=>{this.disposeHandler(e.id,s)}))}}invoke(e){const t=this._panelHandlers.get(e);t&&t.invoke()}select(e){const t=this._panelHandlers.get(e);t&&t.completer.selectActive()}async generateReconciliator(e){let t=[];for(const s of this._activeProviders){const i=this._providers.get(s);i&&await i.isApplicable(e)&&t.push(i)}return new P({context:e,providers:t,timeout:this._timeout})}disposeHandler(e,t){var s;null===(s=t.completer.model)||void 0===s||s.dispose(),t.completer.dispose(),t.dispose(),this._panelHandlers.delete(e)}async generateHandler(e){var t;const s=[...this._activeProviders][0],i=this._providers.get(s);let o=null!==(t=null==i?void 0:i.renderer)&&void 0!==t?t:x.getDefaultRenderer(e.sanitizer);const n=null==i?void 0:i.modelFactory;let r;r=n?await n(e):new u;const{sanitizer:l}=e,d=new x({model:r,renderer:o,sanitizer:l});d.showDocsPanel=this._showDoc,d.hide(),v.Widget.attach(d,document.body);const c=await this.generateReconciliator(e),h=new a({completer:d,reconciliator:c});return h.editor=e.editor,h}}}}]);